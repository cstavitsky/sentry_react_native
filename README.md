This is demo repo is used by Solution Engineers when demo'ing Sentry's [React Native](https://docs.sentry.io/platforms/react-native) SDK's capabilties. 

## Versions

| dependency      | version           
| ------------- |:-------------:| 
| react-native     | 0.64.0  |
| gradle           | 6.7     |
| react           | 16.13.1    |
| sentry/react-native      | 2.4.0    |

## Setup

Please see [INSTALL.md](./Install.md) for some of the things needed.

**If it's your first time adding sentry sdk to an app, you need to run:**
```
$npx @sentry/wizard -i reactNative -p ios android
```
Run this command to launch the [Sentry wizard](https://github.com/getsentry/sentry-wizard) allowing you to [link](https://docs.sentry.io/platforms/react-native/#linking) with the correct Sentry react-native project.  
This also creates a `ios/sentry.properties` and `android/sentry.properties`.

**Otherwise, start at step 1 here:**

1. git clone git@github.com:sentry-demos/sentry_react_native.git
2. Add your DSN and URL for back-end to src/dsn.tx
3. `export SENTRY_AUTH_TOKEN=<token>`
4. Don't forget to bump your release version depending on platform  
iOS: `Info.plist` `CFBundleShortVersionString`  
android: `app.build.gradle` `versionName`  
5. setup a AVD Manager emulator
6. `cd ios && pod install`

## Run

1. start the emulator by AVD Manager or:
```
emulator -list-avds
emulator @{YourEmulator} -dns-server 8.8.8.8

// emulator is at /Users/<user>/Library/Android/sdk/emulator
```
2. Run Ios or Android app
* _iOS  version_: `npx react-native run-ios --configuration Release`
* _Android version_: `npx react-native run-android --variant Release`

## Expected Behavior

Toolstore            |  Checkout
:-------------------------:|:-------------------------:
![list of tools](./img/toolstore.png)  |  ![checkout cart](./img/cart.png)| 

## Upgrade path
1. npm install
2. SDK Manager -> install 'emulator' or anything missing
3. Review previous PR so you know what to expect 

## Troubleshooting 

#### Repo
This repo borrowed from [original react-native repo ]( https://github.com/sentry-demos/react-native/commit/269f58d63426065a4de67a3f22d2e774787cd996)  
The following may have been borrowed: `package.json`, `package-lock.json`, `ios/Podfile`, `ios/Podfile.lock`, see [pull/2](https://github.com/sentry-demos/sentry_react_native/pull/2) 

Please know that react-native generates it own [.gitignore file](https://stackoverflow.com/questions/49099131/recommended-gitignore-for-react-native/49099219
), which is of course part of this repo, so only those [autogenerated files](https://stackoverflow.com/questions/48448426/why-dont-we-gitignore-ios-and-android-in-react-native ) that are required for a baseline setup and the original demo code (files) are part of this repo. 

Please see [Steps](#what-were-the-steps-again) or go through the [first ten commits](https://github.com/sentry-demos/sentry_react_native/commits/master) (and their git log) messages in chronological order, to see the exact commands that were run and what files that were autogenerated.

#### What were the steps again
This is just the background steps to answer "How did we get here ?" . Below is not needed/related to the demoing this app.
```
// generates boilerplate code
npx react-native init sentry_react_native
cd sentry_react_native
cd ios
// Edit Podfile to remove/comment out flipper install as suggested in the comments of the file itself
pod install
// add Sentry SDKs
npm install --save @sentry/react-native
npx @sentry/wizard -i reactNative -p ios android (and select you Sentry react native project )
cd ios
pod install
```

#### adding Sentry for first time
When running npx @sentry/wizard -i reactNative -p ios android  
At this point, you may get an error like:  
`TypeError [ERR_INVALID_ARG_TYPE]: The "data" argument must be of type string or an instance of Buffer, TypedArray, or DataView. Received undefined`  
It should be safe to look past this error. A minor issue is that it blocks creation of `ios/sentry.properties`. So simply make a copy of `android/sentry.properties` and put it in `ios/sentry.properties`:  
```
cp andoid/sentry.properties ios/sentry.properties
cd ios
pod install
```

If all else fails and you seem to be getting a weird error related to IllegalAccessErrors or anything else you may need to rebuild your Android and iOS folders using the following (just make sure to grab the sentry.properties files, build.gradle files, and pod files from Github afterwards):

```
sudo rm -rf android/ ios/
yarn add react-native-eject
npx react-native eject
```

#### Emulators
When running emulator...  
If the app launches and suddenly crashes you may need to reinstall your node package with this command:

```
rm -rf node_modules
npm install
```

Emulator needs  Internet access enabled on your Android emulator. Use AVD Manager or:

#### Running
You may run into issues if you haven't added sdk and sdk platform-tools to path:
`export ANDROID_SDK_ROOT=/Users/<user>/Library/Android/sdk`
`export PATH=/Users/<user>/Library/Android/sdk/platform-tools:$PATH`

"error: Can't find the 'node' binary to build the React Native bundle." should be okay